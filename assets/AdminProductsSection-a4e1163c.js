import{r as l,j as e,l as T,u as L,m as v}from"./index-734983d3.js";import{c as G,d as V,e as B,f as O,g as q}from"./adminApis-1b285698.js";import{M as D,D as z}from"./DeleteModal-770daf23.js";import{I as p}from"./InputGroup-550630f0.js";import{T as I}from"./TextareaGroup-d5918a56.js";import{u as E}from"./useMessage-954c1b46.js";import{P as H}from"./Pagination-873100f4.js";import{u as J}from"./useDispatch-da7203d2.js";import"./react-toastify.esm-5693ab4b.js";const K=({handleCancelProductModal:b,fetchProducts:_,modalOpenType:c,editProductTarget:N})=>{const f={title:"",category:"",origin_price:"",price:"",unit:"",description:"",content:"",is_enabled:1,imageUrl:"",imagesUrl:["","","","",""]},[a,n]=l.useState(f),{inputToastMessage:d}=E(),[U,h]=l.useState(!1),P=l.useRef(null);l.useEffect(()=>{c==="create"?n(f):c==="edit"&&n(N)},[c,N]);const o=r=>{var g;const{name:s,value:i}=r.target,C=(g=s.match("images"))==null?void 0:g[0];if(["origin_price","price"].includes(s))i<=0?n({...a,[s]:0}):n({...a,[s]:parseInt(i)});else if(s==="is_enabled")n({...a,[s]:+r.target.checked});else if(C){const M=s.substring(10)-1;n(y=>({...y,imagesUrl:y.imagesUrl.map((m,S)=>S===M?i:m)}))}else n({...a,[s]:i})},x=async()=>{try{let r=c==="create",s;r?s=await G(a):s=await V(a,a.id),_(),d(s),b()}catch(r){d(r.response.data),b()}},u=async r=>{try{r.preventDefault(),h(!0);const s=new FormData,i=r.target[0].files[0];if(!i)d({success:!1,message:"請選擇檔案後再進行上傳圖片功能"}),h(!1);else if(i.type.substring(0,5)!=="image"){d({success:!1,message:"格式錯誤，請使用圖片檔案格式，如 .jpg .png"}),h(!1);return}else{s.append("file-to-upload",i);const C="/v2/api/ben0588/admin/upload",g=await T.post(C,s,{headers:{"Content-Type":"multipart/form-data"}});d({success:g.data.success,message:"圖片已上傳成功"}),n({...a,imageUrl:g.data.imageUrl}),h(!1),r.target.reset()}}catch(s){d(s.response.data),h(!1)}},j=()=>P.current.reset();return e.jsx("div",{className:"modal fade",id:"productModal",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:c==="create"?"新增商品":`編輯商品：${N.title}`}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>{j(),b()},"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-5",children:[e.jsx(p,{name:"imageUrl",id:"productImageUrl",type:"text",title:" 輸入主圖片網址",groupClass:"mb-3",labelClass:"form-label",inputClass:"form-control",placeholder:"請輸入圖片連結",onChange:o,value:a.imageUrl}),e.jsx("form",{onSubmit:async r=>u(r),ref:P,children:e.jsx(p,{name:"file-to-upload",id:"productFileImage",type:"file",title:"或 上傳圖片",groupClass:"mb-3",labelClass:"form-label",inputClass:"form-control",children:e.jsx("input",{type:"submit",value:`${U?"圖片上傳中..":"上傳圖片"}`,className:"form-control btn btn-dark mt-1",disabled:!!U})})}),e.jsx("label",{className:"form-label mt-4",children:"請依序輸入 1~5 圖片網址"}),[...Array(5)].map((r,s)=>e.jsx("input",{type:"text",name:`imagesUrl-${s+1} `,className:"form-control mb-1",id:`productImagesUrl${s+1}`,placeholder:`請輸入圖片-${s+1}連結`,onChange:o,value:a.imagesUrl[s]},s+1))]}),e.jsxs("div",{className:"col-7",children:[e.jsx(p,{name:"title",id:"productTitle",type:"text",title:"商品名稱",groupClass:"mb-3",labelClass:"form-label",inputClass:"form-control",onChange:o,value:a.title}),e.jsx(I,{name:"description",id:"productDescription",title:"商品描述",groupClass:"mb-3",labelClass:"form-label",textareaClass:"form-control",placeholder:"請輸入商品的描述",cols:30,rows:2,onChange:o,value:a.description}),e.jsx(I,{name:"content",id:"productContent",title:"商品說明",groupClass:"mb-3",labelClass:"form-label",textareaClass:"form-control",placeholder:"請輸入商品的說明",cols:30,rows:2,onChange:o,value:a.content}),e.jsxs("div",{className:"row g-2",children:[e.jsx(p,{name:"category",id:"productCategory",type:"text",title:"商品分類",groupClass:"col-6 mb-3",labelClass:"form-label",inputClass:"form-control",onChange:o,value:a.category}),e.jsx(p,{name:"unit",id:"productUnit",type:"text",title:"商品單位",groupClass:"col-6 mb-3",labelClass:"form-label",inputClass:"form-control",onChange:o,value:a.unit})]}),e.jsxs("div",{className:"row g-2",children:[e.jsx(p,{name:"origin_price",id:"productOriginPrice",type:"number",title:"商品原價",groupClass:"col-6 mb-3",labelClass:"form-label",inputClass:"form-control",onChange:o,value:a.origin_price}),e.jsx(p,{name:"price",id:"productPrice",type:"number",title:"商品售價",groupClass:"col-6 mb-3",labelClass:"form-label",inputClass:"form-control",onChange:o,value:a.price})]}),e.jsx(p,{name:"is_enabled",id:"productIsEnabled",type:"checkbox",title:"商品啟用",groupClass:"form-check mb-3",labelClass:"form-check-label",inputClass:"form-check-input",onChange:o,checked:!!a.is_enabled})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{j(),b()},children:"取消"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>x(),children:c==="create"?"新增":"儲存"})]})]})})})},le=()=>{const[b,_]=l.useState([]),[c,N]=l.useState({}),f=l.useRef(null),a=l.useRef(null),[n,d]=l.useState("create"),[U,h]=l.useState({}),[P,o]=l.useState({}),{inputToastMessage:x}=E(),u=J();L(t=>t.loading);const[j,r]=l.useState([]),[s,i]=l.useState("");l.useEffect(()=>{f.current=new D("#productModal",{backdrop:"static"}),a.current=new D("#deleteModal",{backdrop:"static"})},[]);const C=(t,w)=>{d(t),h(w),f.current.show()},g=()=>f.current.hide(),M=t=>{o(t),a.current.show()},y=()=>a.current.hide(),m=l.useCallback(async(t=1,w=null)=>{try{u(v(!0));const k=await B(t,w),{products:A,pagination:$}=k;_(A),N($),u(v(!1))}catch(k){x(k.response.data),u(v(!1))}},[]);l.useEffect(()=>{m()},[m]);const S=l.useCallback(async()=>{try{const t=await O(),w=[...new Set(Object.values(t.products).map(k=>k.category))];r(w)}catch(t){x(t.response.data)}},[]);l.useEffect(()=>{S()},[S]);const F=async()=>{try{u(v(!0));const t=await q(P.id);x(t),m(),o({}),y(),u(v(!1))}catch(t){x(t.response.data),u(v(!1)),y()}},R=t=>{i(t.target.value),m(1,t.target.value)};return e.jsxs("div",{className:"p-3",children:[e.jsx(K,{handleCancelProductModal:g,fetchProducts:m,modalOpenType:n,editProductTarget:U}),e.jsx(z,{handleCancelDeleteModal:y,handleDelete:F,title:P.title}),e.jsx("h3",{children:"產品列表"}),e.jsx("hr",{}),e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col",children:e.jsxs("div",{className:"form-floating  ",children:[e.jsxs("select",{name:"category",id:"searchCategory",className:"form-select w-50",onChange:t=>R(t),value:s,children:[e.jsx("option",{className:"bg-dark text-white",value:"",children:"預設全部"}),j==null?void 0:j.map(t=>e.jsx("option",{className:"bg-dark text-white fs-6",value:t,children:t},t))]}),e.jsx("label",{htmlFor:"searchCategory",children:"使用類別搜尋"})]})}),e.jsx("div",{className:"col ",children:e.jsx("button",{type:"button",className:"btn btn-primary float-end",onClick:()=>C("create",{}),children:"建立新商品"})})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"分類"}),e.jsx("th",{scope:"col",children:"名稱"}),e.jsx("th",{scope:"col",children:"售價"}),e.jsx("th",{scope:"col",children:"啟用狀態"}),e.jsx("th",{scope:"col",children:"編輯"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.category}),e.jsx("td",{children:t.title}),e.jsx("td",{children:t.price}),e.jsx("td",{className:`${t.is_enabled?"text-success ":""}`,children:t.is_enabled?"啟用":"未啟用"}),e.jsxs("td",{children:[e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>C("edit",t),children:"編輯"}),e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm ms-2",onClick:()=>M(t),children:"刪除"})]})]},t.id))})]}),e.jsx(H,{changePage:m,totalPage:c.total_pages,currentPage:c.current_page,isPre:c.has_pre,isNext:c.has_next,category:c.category})]})};export{le as default};
