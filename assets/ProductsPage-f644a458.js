import{r as a,j as e,L as F,A as Y,u as y,m as f,B as Z,C as $,D as R,E as ee,y as te}from"./index-bab16cd9.js";import"./Breadcrumb-6f80368b.js";import{g as se,e as ae,h as W}from"./index.esm-bcfb46bf.js";import{b as re,a as z,c as ne,d as ce}from"./clientApis-f5af1890.js";import{u as B}from"./useMessage-2b0aea20.js";import{W as oe}from"./WishlistButtonGroup-727c3845.js";import{u as A}from"./useDispatch-2c39fb79.js";import{P as ie}from"./Pagination-f3b86d8f.js";import{b as le}from"./index.esm-b733173e.js";import{G as D}from"./iconBase-e2350224.js";import"./react-toastify.esm-6290a185.js";const _=a.memo(({product:n})=>{const[u,C]=a.useState(!1),{inputToastMessage:j}=B(),m=A(),k=async()=>{var l;try{C(!0);const g={product_id:n.id,qty:1},p=await re(g);m(Y(g)),C(!1),j(p.data)}catch(g){j((l=g==null?void 0:g.response)==null?void 0:l.data)}};return e.jsxs("div",{className:"card border-light h-100 ",children:[e.jsxs("div",{className:"product-card-img-container ",children:[e.jsx(F,{to:`/products/${n.id}`,children:e.jsx("img",{src:n.imageUrl,className:"card-img-top product-card-img object-fit-cover",alt:n.title,style:{height:"300px"}})}),e.jsx("button",{role:"button",className:"product-card-button-container",onClick:k,title:"加入購物車",disabled:u,children:u?e.jsx("div",{className:"spinner-grow product-card-icon",role:"status",style:{backgroundColor:"white"}}):e.jsx(se,{className:"product-card-icon"})})]}),e.jsxs("div",{className:"card-body position-relative",children:[e.jsx("h5",{className:"card-title fs-6 text-break ",children:e.jsx(F,{to:`/products/${n.id}`,className:"link-primary-hover text-dark",children:n.title})}),e.jsx(oe,{product:n,id:n.id}),e.jsx("p",{className:"card-text fs-6 my-1",children:e.jsx(F,{to:`/products/${n.id}`,className:"link-primary-hover text-muted fs-7",children:n.content})}),e.jsxs("p",{className:"card-text fs-6 text-muted text-decoration-line-through user-select-none opacity-50 mt-3 mb-0",children:["NT$ ",n.origin_price]}),e.jsxs("span",{className:"card-text fs-6 fw-bolder user-select-none text-danger",children:["NT$ ",n.price]})]})]})}),de=()=>{const[n,u]=a.useState([]),[C,j]=a.useState([]),[m,k]=a.useState({}),l=A(),g=y(s=>s.category),{inputToastMessage:p}=B(),v=y(s=>s.search),i=y(s=>s.sorting),d=a.useCallback(async()=>{var s,c;try{l(f(!0));const r=await z();j((s=r==null?void 0:r.data)==null?void 0:s.products),l(f(!1))}catch(r){p((c=r==null?void 0:r.response)==null?void 0:c.data),l(f(!1))}},[]),o=a.useCallback(async(s=1,c)=>{var r,N,S;try{l(f(!0));const h=await ne(s,c);u((r=h==null?void 0:h.data)==null?void 0:r.products),k((N=h==null?void 0:h.data)==null?void 0:N.pagination),l(f(!1))}catch(h){p((S=h==null?void 0:h.response)==null?void 0:S.data),l(f(!1))}},[]),b=a.useCallback(async(s=1)=>{var c;try{l(f(!0));const r=await ce(s),{products:N,pagination:S}=r.data;u(N),k(S),l(f(!1))}catch(r){p((c=r==null?void 0:r.response)==null?void 0:c.data),l(f(!1))}},[]);a.useEffect(()=>{d()},[b,d]),a.useEffect(()=>{g.category!==""?o(1,g.category):b()},[g,b,o]);const w=a.useMemo(()=>[...n].sort((s,c)=>i.sorting==="商品名稱"?s.title.localeCompare(c.title):i.sorting==="價格：由高到低"?c.price-s.price:i.sorting==="價格：由低到高"?s.price-c.price:(i.sorting==="上架時間：由新到舊"||i.sorting==="上架時間：由舊到新",null)),[n,i.sorting]),P=a.useMemo(()=>{let s;if(v.searchText!==""){if(s=[...C].filter(c=>c.title.includes(v.searchText)),i.sorting===""||i.sorting==="建議")return s;if(i.sorting==="商品名稱")return s.sort((c,r)=>c.title.localeCompare(r.title));if(i.sorting==="價格：由高到低")return s.sort((c,r)=>r.price-c.price);if(i.sorting==="價格：由低到高")return s.sort((c,r)=>c.price-r.price);if(i.sorting==="上架時間：由新到舊")return s;if(i.sorting==="上架時間：由舊到新")return s}},[v.searchText,i.sorting]);return e.jsxs("div",{className:"container mb-3 pb-3 pt-1",children:[e.jsx("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-3 mt-5",children:v.isSearch?P==null?void 0:P.map(s=>e.jsx("div",{className:"col",children:e.jsx(_,{product:s})},s.id)):w==null?void 0:w.map(s=>e.jsx("div",{className:"col",children:e.jsx(_,{product:s})},s.id))}),e.jsx("div",{className:"pt-4",children:!v.isSearch&&e.jsx(ie,{changePage:g.category===""?b:o,category:m.category,totalPage:m.total_pages,currentPage:m.current_page,isPre:m.has_pre,isNext:m.has_next})})]})};function he(n){return D({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"path",attr:{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"}},{tag:"path",attr:{d:"M9 4v16"}},{tag:"path",attr:{d:"M15 10l-2 2l2 2"}}]})(n)}function ue(n){return D({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"path",attr:{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"}},{tag:"path",attr:{d:"M15 4v16"}},{tag:"path",attr:{d:"M9 10l2 2l-2 2"}}]})(n)}const ge=()=>{const n=y(t=>t.navbar),u=A(),{inputToastMessage:C}=B(),[j,m]=a.useState([]),[k,l]=a.useState(""),[g,p]=a.useState(""),[v,i]=a.useState("建議"),d=y(t=>t.category),o=y(t=>t.search),b=y(t=>t.sorting),[w,P]=a.useState(!1),s=a.useRef(null),c=a.useRef(null),[r,N]=a.useState(!1),S=a.useRef(null),[h,V]=a.useState(!1),G=["建議","商品名稱","價格：由高到低","價格：由低到高","上架時間：由新到舊","上架時間：由舊到新"],L=()=>{P(!w),s.current.classList.toggle("menu-show"),c.current.classList.toggle("menu-show")},O=t=>{i(t.target.value),u(ee(t.target.value))},q=H(t=>{if(t.target.value!==""){let T={isSearch:!0,searchText:t.target.value.replaceAll(" ","")};u(R(T))}else u($())},1500);function H(t,T=1500){let M;return(...x)=>{clearTimeout(M),M=setTimeout(()=>{t(...x)},T)}}a.useEffect(()=>{p(o.searchText)},[o.searchText]);const X=t=>{l(t.target.value),u(te(t.target.value))};a.useEffect(()=>{l(d.category)},[d.category]);const I=a.useCallback(async()=>{var t,T,M;try{const x=await z(),U=(T=(t=x==null?void 0:x.data)==null?void 0:t.products)==null?void 0:T.map(E=>E.category),J=[...new Set(U)].sort((E,Q)=>Q.localeCompare(E));m(J)}catch(x){C((M=x==null?void 0:x.response)==null?void 0:M.data)}},[]);a.useEffect(()=>{I()},[I]);const K=()=>{V(!h),N(!0),s.current.classList.toggle("search-menu-first-show")};return a.useEffect(()=>{window.innerWidth<=992&&N(!1)},[window.innerWidth,r]),a.useEffect(()=>{(o.searchText!==""||d.category!==""||b.sorting!=="建議")&&setTimeout(()=>{L()},800)},[o.searchText,d.category,b.sorting]),e.jsxs("div",{className:"search-sticky bg-white w-100",style:{position:"sticky",top:`${n.height-1}px`,zIndex:50,height:"50px"},children:[e.jsx("div",{className:"bg-white sidebar-collapse-icon ",onClick:()=>K(),title:h?"展開篩選條件區塊":"收合篩選條件區塊",children:h?e.jsx(ue,{style:{width:"40px",height:"40px"}}):e.jsx(he,{style:{width:"40px",height:"40px"}})}),e.jsxs("div",{className:"search-navbar-container ",ref:S,children:[e.jsxs("label",{htmlFor:"search-check",className:"search-menu-btn",onClick:()=>L(),children:[e.jsx("span",{className:"me-2",children:"篩選"}),w?e.jsx(ae,{className:"search-menu-icon"}):e.jsx(le,{className:"search-menu-icon"})]}),e.jsxs("nav",{className:"",children:[e.jsxs("ul",{className:`${r?"search-menu-first":"search-menu "} mb-0`,ref:s,children:[e.jsx("li",{children:e.jsx("div",{className:` search-menu-items d-flex flex-column justify-content-center align-items-center  ${d!=null&&d.category||o!=null&&o.searchText,""}`,children:d!=null&&d.category?e.jsxs("div",{className:" d-flex justify-content-start justify-content-lg-center align-items-center w-100 ",children:["當前類別：",e.jsxs("mark",{className:"position-relative border border-2 user-select-none bg-white pe-4",children:[d.category,e.jsx(W,{className:"closure-icon position-absolute top-50 end-0 translate-middle-y",role:"button",title:"清除類別選擇",onClick:()=>{L(),u(Z())}})]})]}):o!=null&&o.searchText?e.jsxs("div",{className:"d-flex justify-content-start justify-content-lg-center align-items-center ",children:["當前搜尋：",e.jsxs("mark",{className:"position-relative border border-2 user-select-none bg-white ps-4 pe-5",children:[o.searchText,e.jsx(W,{className:"closure-icon position-absolute top-50 end-0 translate-middle-y",role:"button",title:"清除搜尋目標",onClick:()=>{L(),u($())}})]})]}):null})}),e.jsx("li",{children:e.jsxs("div",{className:"search-menu-items form-floating  ",children:[e.jsxs("select",{name:"category",id:"searchCategory",className:"form-select",onChange:t=>X(t),value:k,disabled:o.searchText!=="",children:[e.jsx("option",{className:"bg-dark text-white",value:"",disabled:!0,children:o.searchText!==""?"不可選擇":" 開始選擇"}),j==null?void 0:j.map(t=>e.jsx("option",{className:"bg-dark text-white fs-6",value:t,children:t},t))]}),e.jsx("label",{htmlFor:"searchCategory",children:"使用類別搜尋"})]})}),e.jsx("li",{children:e.jsxs("div",{className:"search-menu-items form-floating ",children:[e.jsx("select",{name:"category",id:"searchCategory",className:"form-select",onChange:t=>O(t),value:v,children:G.map(t=>e.jsx("option",{className:"bg-dark text-white fs-6",value:t,children:t},t))}),e.jsx("label",{htmlFor:"searchCategory",children:"商品排序"})]})}),e.jsx("li",{children:e.jsxs("div",{className:"search-menu-items form-floating ",children:[e.jsx("input",{type:"search",className:"form-control",id:"searchInput",placeholder:"關鍵字搜尋",onChange:t=>{p(t.target.value),q(t)},onKeyDown:t=>{t.key==="Enter"&&(p(t.target.value),u(R(t.target.value)))},value:g,disabled:d.category!==""}),e.jsx("label",{htmlFor:"searchInput",children:"關鍵字搜尋"})]})})]}),e.jsx("div",{className:"search-blur-bg ",ref:c,onClick:()=>L()})]})]})]})},we=()=>(y(n=>n.category),e.jsxs("div",{className:"position-relative mb-3",children:[e.jsx(ge,{}),e.jsx(de,{})]}));export{we as default};
