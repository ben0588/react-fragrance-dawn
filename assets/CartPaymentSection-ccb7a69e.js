import{d as k,b as B,r as n,m,j as e}from"./index-f680a4e7.js";import{u as M,V as E}from"./ValidationSelectGroup-6c371ccb.js";import{u as F}from"./useMessage-40f2d831.js";import{l as P,m as V}from"./clientApis-81636fb2.js";import{u as q}from"./usePriceToTw-3c01b7f6.js";import{l as A}from"./index.esm-8da124d0.js";import{S as c}from"./sweetalert2.all-2298e9fc.js";import{u as D}from"./useDispatch-c665cdeb.js";import"./react-toastify.esm-80e50f72.js";import"./iconBase-7d7adbf0.js";const Q=()=>{var u,p,f,j,b;const N=k(),o=B();n.useState([]);const{handlePriceToTw:i}=q(),{inputToastMessage:x}=F(),{register:w,handleSubmit:y,formState:{errors:g},reset:C}=M({defaultValues:{paymentMethod:""},mode:"onTouched"}),[t,S]=n.useState({}),d=D(),h=n.useCallback(async()=>{var s,r,a,v;try{if(o.state===null)return;d(m(!0));const l=await P(o.state),L={...(s=l==null?void 0:l.data)==null?void 0:s.order,products:Object.values((a=(r=l==null?void 0:l.data)==null?void 0:r.order)==null?void 0:a.products)};S(L),d(m(!1))}catch(l){x((v=l==null?void 0:l.response)==null?void 0:v.data),d(m(!1))}},[]);n.useEffect(()=>{h()},[o,h]);const T=async s=>{var r;try{o.state=null,c.fire({icon:"info",title:"付款中",showConfirmButton:!1,allowEscapeKey:!1,didOpen:async()=>{try{c.showLoading();const a=await V(t.id);c.hideLoading(),c.update({icon:"success",title:`${a.data.message}`,showConfirmButton:!0,confirmButtonColor:"#111c30",confirmButtonText:"確認"})}catch(a){c.hideLoading(),c.update({icon:"error",title:"付款失败",text:a,showConfirmButton:!0})}},allowOutsideClick:()=>!c.isLoading()}).then(a=>{a.isConfirmed&&(C(),window.history.replaceState(null,null,window.location.href),N("/account/orders",{state:null}))})}catch(a){x((r=a==null?void 0:a.response)==null?void 0:r.data)}},O=[{text:"信用卡一次付清"},{text:"信用卡分期"},{text:"信用卡紅利折抵"},{text:"行動支付"},{text:"ATM轉帳(4小時內付款)"},{text:"超商付款"},{text:"中租銀角零卡"},{text:"銀聯卡"}];return Object.keys(t).length===0?e.jsx("div",{className:"my-5 fs-5",children:"無訂單資料"}):e.jsx("div",{className:"mb-3 pb-3",children:e.jsxs("div",{className:"row flex-column-reverse flex-lg-row",children:[e.jsxs("div",{className:"col-12 col-lg-6 mt-3",children:[e.jsx("h4",{className:" fs-5 ",children:"結帳"}),e.jsxs("form",{onSubmit:y(T),children:[e.jsxs(E,{id:"paymentMethod",labelText:"選擇付款方式",groupClass:"py-2",labelClass:"form-label mb-1",selectClass:"form-control",errors:g,register:w,rules:{required:{value:!0,message:"必須選擇付款方式"}},defaultValue:"",children:[e.jsx("option",{className:"bg-dark text-white",value:"",children:"請選擇付款方式"}),O.map(s=>e.jsx("option",{value:s.text,className:"bg-dark text-white",children:s.text},s.text))]}),e.jsx("input",{type:"submit",value:"確認付款",className:"btn btn-primary btn-primary-hover float-end mt-2 mb-3",style:{width:"120px"}})]})]}),e.jsxs("div",{className:"col-12 col-lg-6 ",children:[e.jsxs("div",{className:"border border-2 p-3",children:[e.jsx("h4",{className:"border-bottom border-2 border-primary fs-5 pb-2",children:"寄送資料明細"}),e.jsxs("div",{className:"row mt-3",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("div",{children:"姓名"}),e.jsx("div",{children:"電子信箱"}),e.jsx("div",{children:"寄送地址"}),e.jsx("div",{children:"聯絡人電話"})]}),e.jsxs("div",{className:"col-8",children:[e.jsx("div",{children:(u=t==null?void 0:t.user)==null?void 0:u.name}),e.jsx("div",{children:(p=t==null?void 0:t.user)==null?void 0:p.email}),e.jsx("div",{children:(f=t==null?void 0:t.user)==null?void 0:f.address}),e.jsx("div",{children:(j=t==null?void 0:t.user)==null?void 0:j.tel})]})]})]}),e.jsxs("div",{className:"border border-2 mt-4 p-3",children:[e.jsx("h4",{className:"border-bottom border-2 border-primary fs-5 pb-2",children:"訂單明細"}),(b=t==null?void 0:t.products)==null?void 0:b.map(s=>{var r,a;return e.jsxs("div",{className:"row mt-3 border-bottom border-2 pb-3",children:[e.jsx("div",{className:"col-3",children:e.jsx("img",{src:s.product.imageUrl,alt:s.product.title,title:s.product.title,style:{width:"75px",height:"75px"}})}),e.jsx("div",{className:"col-7",children:e.jsxs("div",{className:"d-flex justify-content-center align-items-start flex-column",children:[e.jsx("span",{children:s.product.title}),e.jsxs("span",{className:"text-muted fs-7",children:["總價：NT",i(s.total)]})]})}),e.jsx("div",{className:"col-2",children:e.jsxs("div",{className:"d-flex justify-content-center align-items-start flex-column ",children:[e.jsxs("span",{children:["x ",s.qty]}),e.jsx("span",{className:"opacity-0 fs-7",children:"|"})]})}),e.jsx("div",{className:"col-8",children:(r=s==null?void 0:s.coupon)!=null&&r.code?e.jsxs("span",{className:"mt-1 text-danger float-start d-flex align-items-center",children:[e.jsx(A,{className:"icon me-1"}),"使用優惠：",(a=s==null?void 0:s.coupon)==null?void 0:a.code]}):null}),e.jsx("div",{className:"col-4",children:e.jsxs("span",{className:"mt-1 fw-border float-end",children:["NT",i(s.final_total)]})})]},s.id)}),e.jsxs("div",{className:"row row-cols-2 pt-3",children:[e.jsx("div",{className:"col",children:e.jsx("span",{className:"fs-3 fw-bolder",children:"訂單總額"})}),e.jsx("div",{className:"col",children:e.jsxs("span",{className:"float-end fs-3 fw-bolder",children:["NT",i(t.total)]})})]})]})]})]})})};export{Q as default};
