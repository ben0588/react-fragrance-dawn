import{r as l,j as s,u as L,m as v}from"./index-c017eb27.js";import{M as g,D as R}from"./DeleteModal-1e69360b.js";import{l as I,m as V,n as q,o as A}from"./adminApis-b255d445.js";import{P as $}from"./Pagination-a0f68af4.js";import{u as S}from"./useMessage-df467658.js";import{I as G}from"./InputGroup-f556ad76.js";import{S as F}from"./SelectGroup-7f69d8c7.js";import{u as M}from"./usePriceToTw-2d18d770.js";import{S as o}from"./sweetalert2.all-d24188b6.js";import{u as z}from"./useDispatch-79fc180b.js";import"./react-toastify.esm-9b44aecd.js";const H=({handleCancelOrderModal:h,fetchOrders:f,editOrderTarget:a})=>{var j,b,C;const[n,i]=l.useState({is_paid:"",status:0,...a}),{inputToastMessage:p}=S(),{handlePriceToTw:N}=M();l.useEffect(()=>{i({...a,is_paid:a.is_paid,status:a.status})},[a]);const w=c=>{const{name:u,value:x}=c.target;i(u==="is_paid"?{...n,[u]:c.target.checked}:{...n,[u]:x})},y=async()=>{try{const c=await I(n.id,{data:{...n}});p(c),f(),h()}catch(c){p(c.response.data),h()}};return s.jsx("div",{className:"modal fade",id:"orderModal",children:s.jsx("div",{className:"modal-dialog modal-lg",children:s.jsxs("div",{className:"modal-content py-1 px-3",children:[s.jsxs("div",{className:"modal-header px-0 ",children:[s.jsxs("h5",{className:"modal-title fw-bolder ",children:["編輯訂單：",a.id]}),s.jsx("button",{type:"button",className:"btn-close",onClick:()=>h(),"aria-label":"Close"})]}),s.jsxs("div",{className:"modal-body fw-bolder",children:[s.jsxs("ul",{className:"list-unstyled p-3",children:[s.jsx("li",{className:"pb-4",children:s.jsxs("div",{className:"row",children:[s.jsx("span",{className:"col-2 fw-bolder",children:"Email"}),s.jsx("span",{className:"col-10",children:(j=a==null?void 0:a.user)==null?void 0:j.email})]})}),s.jsx("li",{className:"pb-4",children:s.jsxs("div",{className:"row",children:[s.jsx("span",{className:"col-2 fw-bolder",children:"訂購者"}),s.jsx("span",{className:"col-10",children:(b=a==null?void 0:a.user)==null?void 0:b.name})]})}),s.jsx("li",{className:"pb-4",children:s.jsxs("div",{className:"row",children:[s.jsx("span",{className:"col-2 fw-bolder",children:"外送地點"}),s.jsx("span",{className:"col-10",children:(C=a==null?void 0:a.user)==null?void 0:C.address})]})}),s.jsx("li",{className:"pb-4",children:s.jsxs("div",{className:"row",children:[s.jsx("span",{className:"col-2 fw-bolder",children:"留言"}),s.jsx("span",{className:"col-10",children:a.message})]})})]}),s.jsxs("div",{className:"table-responsive ",children:[s.jsxs("table",{className:"table mb-0",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",children:"品項名稱"}),s.jsx("th",{scope:"col",children:"數量"})]})}),s.jsx("tbody",{className:"table-group-divider",children:s.jsxs("tr",{children:[s.jsx("td",{children:a.products&&Object.entries(a.products)[0].map(c=>c)[1].product.title}),s.jsx("td",{children:a.products&&Object.entries(a.products)[0].map(c=>c)[1].qty})]})})]}),s.jsxs("span",{className:"float-end fw-bolder mt-2 ",children:["總金額：NT",N(a.total)]})]}),s.jsxs("div",{className:"",children:[s.jsx("strong",{className:"fs-5",children:"修改訂單狀態"}),s.jsx(G,{name:"is_paid",id:"orderIsPaid",type:"checkbox",title:`付款狀態 ${n.is_paid?"(已付款)":"(未付款)"}`,groupClass:"form-check mb-3 py-2",labelClass:"form-check-label ",inputClass:"form-check-input",onChange:w,checked:!!n.is_paid||!1})]}),s.jsxs(F,{name:"status",id:"orderStatus",title:"寄送進度",groupClass:"py-2",labelClass:"form-label mb-1",selectClass:"form-select",onChange:w,defaultValue:(n==null?void 0:n.status)||"",children:[s.jsx("option",{className:"bg-dark text-white",value:0,children:"未確認"}),s.jsx("option",{className:"bg-dark text-white",value:1,children:"已確認"}),s.jsx("option",{className:"bg-dark text-white",value:2,children:"寄送中"}),s.jsx("option",{className:"bg-dark text-white",value:3,children:"已送達"})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>h(),children:"關閉"}),s.jsx("button",{type:"button",className:"btn btn-primary ",onClick:()=>y(),children:"儲存"})]})]})})})},es=()=>{const[h,f]=l.useState([]),[a,n]=l.useState({}),i=l.useRef(null),p=l.useRef(null),[N,w]=l.useState("create"),[y,j]=l.useState({}),[b,C]=l.useState({}),{inputToastMessage:c}=S(),{handlePriceToTw:u}=M(),x=z();L(e=>e.loading),l.useEffect(()=>{i.current=new g("#orderModal",{backdrop:"static"}),p.current=new g("#deleteModal",{backdrop:"static"})},[]);const _=e=>{j(e),i.current.show()},P=()=>i.current.hide(),B=()=>p.current.hide(),m=l.useCallback(async(e=1)=>{try{x(v(!0));const t=await V(e),{orders:d,pagination:r}=t;f(d),n(r),x(v(!1))}catch(t){c(t.response.data),x(v(!1))}},[]);l.useEffect(()=>{m()},[m]);const D=async e=>{try{o.fire({title:"確認刪除訂單?",text:"注意：刪除訂單後無法再復原，請謹慎操作",icon:"question",confirmButtonColor:"#111c30",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,preConfirm:async()=>{try{return await q(e)}catch(t){o.showValidationMessage(`請求失敗： ${t}`)}},allowOutsideClick:()=>!o.isLoading()}).then(t=>{var d,r,k;(d=t==null?void 0:t.value)!=null&&d.success&&(o.fire("成功",(k=(r=t==null?void 0:t.value)==null?void 0:r.data)==null?void 0:k.message,"success"),m())})}catch(t){c(t.response.data)}},E=async()=>{try{o.fire({title:"確認刪除全部訂單?",text:"注意：刪除全部訂單後無法再復原，請謹慎操作",icon:"question",confirmButtonColor:"#d63031",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,preConfirm:async()=>{try{return await A()}catch(e){o.showValidationMessage(`請求失敗： ${e}`)}},allowOutsideClick:()=>!o.isLoading()}).then(e=>{var t,d,r;(t=e==null?void 0:e.value)!=null&&t.success&&(o.fire("成功",(r=(d=e==null?void 0:e.value)==null?void 0:d.data)==null?void 0:r.message,"success"),m())})}catch(e){c(e.response.data)}};return s.jsxs("div",{className:"p-3",children:[s.jsx(H,{handleCancelOrderModal:P,fetchOrders:m,modalOpenType:N,editOrderTarget:y}),s.jsx(R,{handleCancelDeleteModal:B,title:b.title}),s.jsx("h3",{children:"訂單列表"}),s.jsx("button",{onClick:()=>E(),type:"button",className:"btn btn-outline-danger",children:"刪除所有訂單"}),s.jsx("hr",{}),s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",children:"訂單 id"}),s.jsx("th",{scope:"col",children:"購買用戶"}),s.jsx("th",{scope:"col",children:"訂單金額"}),s.jsx("th",{scope:"col",children:"付款狀態"}),s.jsx("th",{scope:"col",children:"付款日期"}),s.jsx("th",{scope:"col",children:"留言訊息"}),s.jsx("th",{scope:"col",children:"編輯"})]})}),s.jsx("tbody",{children:h.map(e=>{var t;return s.jsxs("tr",{children:[s.jsx("td",{children:e.id}),s.jsx("td",{children:(t=e==null?void 0:e.user)==null?void 0:t.email}),s.jsx("td",{children:u(e.total)}),s.jsx("td",{children:e.is_paid?s.jsx("span",{className:"text-success fw-bold",children:"付款完成"}):"未付款"}),s.jsx("td",{children:e.paid_date?new Date(e.paid_date*1e3).toISOString().split("T")[0]:"未付款"}),s.jsx("td",{children:e.message}),s.jsxs("td",{children:[s.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>_(e),children:"編輯"}),s.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm ms-2",onClick:()=>D(e.id),children:"刪除"})]})]},e.id)})})]}),s.jsx($,{changePage:m,totalPage:a.total_pages,currentPage:a.current_page,isPre:a.has_pre,isNext:a.has_next})]})};export{es as default};
